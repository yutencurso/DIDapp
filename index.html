<html>
<head>
<title>Instalar DIDapp</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
<style>
    body{
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-family: "Open Sans";
        background-image: linear-gradient(blue, #f0f);
    }
    button{
        border-radius: 20px;
        border: none;
        background-color: #f0f;
        font-size: 40px;
        border: 4px solid #f0f;
    }
    button:hover{
        border: 4px solid #f0f;
        background-color: #fff;
    }
    div{
        border-radius: 20px;
        box-shadow: 7px 7px 15px #101010;
        background-color: #fff;
    }
</style>
    <link rel="manifest" href="manifest.json">
</head>
<body><div>
    <h1>DIDapp</h1>
    <p><a onclick="descripcion()" style="text-decoration: underline;">Descripción</a></p>
    <button id="installButton" onclick="instalar()">Instalar</button></div>
    <script>
        let deferredPrompt;
        const installButton = document.getElementById('installButton');
        userAgent = navigator.userAgent;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
        });
        function instalar() {
            installButton.innerText = 'Instalando...';
            installButton.disabled = true;
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        installButton.innerText = 'Reinicia, por favor';
                        setTimeout(() => { installButton.innerText = "Instalar"; }, 5000);
                    }
                    else {
                        installButton.disabled = false;
                        installButton.innerText = 'Error, intentalo de nuevo';
                        setTimeout(() => { installButton.innerText = "Instalar"; }, 5000);
                    }
                    deferredPrompt = null;
                });
            }
        }
        function descripcion() {
            alert("Esta app sirve para acceder a tus servicios DID favoritos desde una app")
        }
    </script>
    <script>
        if (userAgent.includes('Chrome')) {
            installButton.innerText = 'Instalar';
        }
        else {
            installButton.disabled = true;
            installButton.innerText = 'No compatible, solo chrome';
        }
        const mediaQuery = window.matchMedia('(display-mode: standalone)');
        function handleDisplayMode(event) {
            if (event.matches) {
                console.log("Detectado: Modo PWA Instalada. Redireccionando a app.html...");
                window.location.href = "app.html"; 
            } else {
                console.log("Detectado: Modo Navegador Web. Permanece en esta página.");
            }
        }
        mediaQuery.addEventListener('change', handleDisplayMode);
        handleDisplayMode(mediaQuery);
    </script>
</body>
</html>




